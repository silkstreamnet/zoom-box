(function(k){function q(b,a){var g=b.attr(a);return"undefined"==typeof g?"":g}function n(b,a){if(b.zbobj){if("function"===typeof a.onUpdateScale)a.onUpdateScale(a);var g=k("body"),j=!1;if(a.fitBoxTo==window&&(a.position="fixed")){var j=!0,f=g.width();g.css("overflow","hidden");var h=g.width();h>f&&(f=parseInt(g.css("margin-right"))+(h-f),g.css("margin-right",f+"px"))}b.zbobj.css({top:"0",left:"0"});"string"==typeof a.boxClass&&""!=a.boxClass&&b.zbobj.addClass(a.boxClass);"string"==typeof a.boxId&&""!=a.boxId&&b.zbobj.attr("id",a.boxId);var d=a.boxWidth,e=a.boxHeight,f=a.boxLeft,h=a.boxTop;"not set"!=d&&("auto"==d?(d=a.fitBoxTo==window?b.relativeFit.width():b.relativeFit.outerWidth(!1),b.zbobj.width(d)):"string"==typeof d&&d.match(/[0-9]{1,2}%/)?b.zbobj.css("width",d):b.zbobj.width(parseFloat(d)));"not set"!=e&&("auto"==e?(e=a.fitBoxTo==window?b.relativeFit.height():b.relativeFit.outerHeight(!1),b.zbobj.height(e)):"string"==typeof e&&e.match(/[0-9]{1,2}%/)?b.zbobj.css("height",e):b.zbobj.height(parseFloat(e)));d=b.zbobj.offset();e=b.relativeAlign?b.relativeAlign.offset():0;"not set"!=f?"auto"==f?(f=a.alignBoxTo==window?"fixed"!=a.position&&0<d.left?-d.left:0:d.left==e.left?0:d.left>e.left?0-(d.left-e.left):e.left-d.left,b.zbobj.css("left",f+"px")):"string"==typeof f&&f.match(/[0-9]{1,2}%/)?b.zbobj.css("left",f):b.zbobj.css("left",parseFloat(f)+"px"):b.zbobj.css("left","");"not set"!=h?"auto"==h?(h=a.alignBoxTo==window?"fixed"!=a.position&&0<d.top?-d.top:0:d.top==e.top?0:d.top>e.top?0-(d.top-e.top):e.top-d.top,b.zbobj.css("top",h+"px")):"string"==typeof h&&h.match(/[0-9]{1,2}%/)?b.zbobj.css("top",h):b.zbobj.css("top",parseFloat(h)+"px"):b.zbobj.css("top","");var f=a.naturalImgWidth,h=a.naturalImgHeight,d=b.zbobj.width(),e=b.zbobj.height(),c=f/d,m=h/e,i=f,p=h;if(1>m||1>c)c<m?(i=d,p*=i/f):(p=e,i*=p/h);b.zbimg.width(i);b.zbimg.height(p);j&&"fixed"!=a.position&&g.css("overflow",a.defaultBodyOverflow);g=b.zbobj.offset();a.mouseX=g.left+b.zbobj.width()/2;a.mouseY=g.top+b.zbobj.height()/2;r(b,a)}}function v(b,a){var g=a.timeoutSpeed,j=b.zbobj.width(),f=b.zbobj.height(),h=b.zbimg.width(),d=b.zbimg.height(),e=b.zbobj.offset(),c=b.zbimg.offset(),m=-1*(a.mouseX-e.left)/j*(h-j),i=-1*(a.mouseY-e.top)/f*(d-f),j=h==j?0:-(h-j);0<=m?m=0:m<j&&(m=j);f=d==f?0:-(d-f);0<=i?i=0:i<f&&(i=f);f=parseFloat(c.left-e.left);e=parseFloat(c.top-e.top);c=f;c=e;m!=f&&(c=m-f,d=0.2*(m-f),1>c&&-1<c&&(d=c),c=Math.floor(10*(f+d))/10,b.zbimg.css("left",c+"px"));i!=e&&(c=i-e,d=0.2*(i-e),1>c&&-1<c&&(d=c),c=Math.floor(10*(e+d))/10,b.zbimg.css("top",c+"px"));!1!==a.animator.timer&&(clearTimeout(a.animator.timer),a.animator.timer=!1);if(!1===a.animator.timer&&(f!=m||e!=i))a.animator.timer=setTimeout(function(){v(b,a)},g)}function r(b,a){b.zbobj&&a&&!1===a.animator.timer&&v(b,a)}function w(b,a){var g=k("body");a.defaultBodyOverflow=g.css("overflow");a.defaultMarginRight=g.css("margin-right");var g=a.zbid,j="",f=0,h=0,d=b,j=q(d,"src");if(!j){var e=b.find("img");0<e.length&&(d=e.eq(0),j=q(d,"src"))}j&&(f=d.width(),h=d.height());a.naturalImgWidth=f;a.naturalImgHeight=h;var j='<div class="zoom-box-container" data-zbid="'+g+'"><a href="javascript:void(0);" class="zoom-box-close">'+("string"==typeof a.closeText?a.closeText:"")+'</a><img src="'+j+'" alt="" /></div>',c={relativeHolder:"object"==typeof a.appendBoxTo&&a.appendBoxTo!=window?a.appendBoxTo:k(a.appendBoxTo),relativeFit:"object"==typeof a.fitBoxTo&&a.fitBoxTo!=window||!a.fitBoxTo?a.fitBoxTo:k(a.fitBoxTo),relativeAlign:"object"==typeof a.alignBoxTo&&a.alignBoxTo!=window||!a.alignBoxTo?a.alignBoxTo:k(a.alignBoxTo)};if(c.relativeHolder.length){var m=!1;c.relativeHolder=c.relativeHolder.eq(0);c.relativeHolder.append(j);c.zbobj=c.relativeHolder.find('.zoom-box-container[data-zbid="'+g+'"]');c.zbimg=c.zbobj.find("img");c.zbclose=c.zbobj.find("a.zoom-box-close");c.zbobj.css({position:a.position,"z-index":"990",visibility:"hidden"});c.zbimg.css({position:"absolute","z-index":"991","max-width":"none","max-height":"none"});c.zbclose.css({position:"absolute","z-index":"992"});n(c,a);c.zbobj.css({visibility:"visible",overflow:"hidden",display:"none"}).fadeIn(400,function(){setTimeout(function(){m=!0},100)});c.zbimg.on("dragstart",function(a){a.preventDefault()});c.zbobj.on("mousemove",function(b){m&&(a.mouseX=b.pageX,a.mouseY=b.pageY,r(c,a))}).on("touchmove",function(b){b.preventDefault();m&&(a.mouseX=b.originalEvent.touches[0].pageX,a.mouseY=b.originalEvent.touches[0].pageY,r(c,a))}).on("mousedown",function(b){b.preventDefault();a.mouseDownX=b.pageX;a.mouseDownY=b.pageY}).on("mouseup",function(b){b.preventDefault();b.pageX<=a.mouseDownX+5&&(b.pageX>=a.mouseDownX-5&&b.pageY<=a.mouseDownY+5&&b.pageY>=a.mouseDownY-5)&&x(c,a);a.mouseDownX=-999;a.mouseDownY=-999});c.zbclose.click(function(b){b.preventDefault();x(c,a)});l[g-1].zbobjects=c;a._imageSource="auto"==a.imageSource?q(b,"href"):a.imageSource;a.naturalImgWidth=0;a.naturalImgHeight=0;if(a._imageSource){var i=new Image;i.src=a._imageSource;setTimeout(function(){i.complete?(a.naturalImgWidth=i.width,a.naturalImgHeight=i.height,c.zbimg.attr("src",a._imageSource),n(c,a)):i.onload=function(){a.naturalImgWidth=this.width;a.naturalImgHeight=this.height;c.zbimg.attr("src",a._imageSource);n(c,a)}},1)}a.isopen=!0}else a.isopen=!1}function x(b,a){a.isopen&&(b.zbobj.fadeOut(400,function(){b.zbobj.remove();b={};delete l[a.zbid-1].zbobjects;!1!==a.animator.timer&&(clearTimeout(a.animator.timer),a.animator.timer=!1);k("body").css({overflow:a.defaultBodyOverflow,"margin-right":a.defaultMarginRight})}),a.isopen=!1)}var s={boxWidth:"auto",boxHeight:"auto",boxLeft:"auto",boxTop:"auto",allowDrag:!0,imageSource:"auto",appendBoxTo:"body",fitBoxTo:window,alignBoxTo:window,boxId:"",boxClass:"",position:"fixed",closeText:"",delegate:"",onUpdateScale:!1},l=[];k.fn.ZoomBox=function(b){var b=b||{},a=k.extend({},s,b),b=k(this);if(0<b.length){var g=k("body"),j=g.css("overflow"),f=g.css("margin-right"),h=Math.round(1E3/30);b.each(function(){var b=k(this),e="string"==typeof a.delegate?a.delegate:"",c=k.extend({},a),g;for(g in s)if(s.hasOwnProperty(g)){var i=q(b,"data-"+g.toLowerCase());i&&(c[g]=i)}c.zbid=l.length+1;c.animator={timer:!1,startTime:0};l.push({object:b,settings:c});c.isopen=!1;c.defaultBodyOverflow=j;c.defaultMarginRight=f;c.timeoutSpeed=h;c.mouseX=0;c.mouseY=0;c.mouseDownX=-999;c.mouseDownY=-999;if(e)b.on("click",e,function(a){a.preventDefault();c.isopen||w(k(this),c)});else b.on("click",function(a){a.preventDefault();c.isopen||w(k(this),c)})})}};var t=!1;k(window).on("resize.zoombox",function(){!1==t&&(t=!0,setTimeout(function(){for(var b=0;b<l.length;b++)"undefined"!==typeof l[b].zbobjects&&n(l[b].zbobjects,l[b].settings);t=!1},100))});var u=!1;k(window).on("scroll.zoombox",function(){if(!1==u){for(var b=0;b<l.length;b++)"undefined"!==typeof l[b].zbobjects&&n(l[b].zbobjects,l[b].settings);u=!0;setTimeout(function(){for(var a=0;a<l.length;a++)"undefined"!==typeof l[a].zbobjects&&n(l[a].zbobjects,l[a].settings);u=!1},10)}})})(jQuery);
