(function(g){function t(a,d){var k=a.attr(d);return"undefined"==typeof k?"":k}function p(a,d){if(a.zbobj){if("function"===typeof d.onUpdateScale)d.onUpdateScale(d);var k=g("body"),i=!1;if(d.fitBoxTo==window&&(d.position="fixed")){var i=!0,e=k.width();k.css("overflow","hidden");var h=k.width();h>e&&(e=parseInt(k.css("margin-right"))+(h-e),k.css("margin-right",e+"px"))}a.zbobj.css({top:"0",left:"0"});"string"==typeof d.boxClass&&""!=d.boxClass&&a.zbobj.addClass(d.boxClass);"string"==typeof d.boxId&&""!=d.boxId&&a.zbobj.attr("id",d.boxId);var c=d.boxWidth,b=d.boxHeight,e=d.boxLeft,h=d.boxTop;"not set"!=c&&("auto"==c?(c=d.fitBoxTo==window?a.relativeFit.width():a.relativeFit.outerWidth(!1),a.zbobj.width(c)):"string"==typeof c&&c.match(/[0-9]{1,2}%/)?a.zbobj.css("width",c):a.zbobj.width(parseInt(c)));"not set"!=b&&("auto"==b?(b=d.fitBoxTo==window?a.relativeFit.height():a.relativeFit.outerHeight(!1),a.zbobj.height(b)):"string"==typeof b&&b.match(/[0-9]{1,2}%/)?a.zbobj.css("height",b):a.zbobj.height(parseInt(b)));c=a.zbobj.offset();b=a.relativeAlign?a.relativeAlign.offset():0;"not set"!=e?"auto"==e?(e=d.alignBoxTo==window?"fixed"!=d.position&&0<c.left?-c.left:0:c.left==b.left?0:c.left>b.left?0-(c.left-b.left):b.left-c.left,a.zbobj.css("left",e+"px")):"string"==typeof e&&e.match(/[0-9]{1,2}%/)?a.zbobj.css("left",e):a.zbobj.css("left",parseInt(e)+"px"):a.zbobj.css("left","");"not set"!=h?"auto"==h?(h=d.alignBoxTo==window?"fixed"!=d.position&&0<c.top?-c.top:0:c.top==b.top?0:c.top>b.top?0-(c.top-b.top):b.top-c.top,a.zbobj.css("top",h+"px")):"string"==typeof h&&h.match(/[0-9]{1,2}%/)?a.zbobj.css("top",h):a.zbobj.css("top",parseInt(h)+"px"):a.zbobj.css("top","");var e=d.naturalImgWidth,h=d.naturalImgHeight,c=a.zbobj.width(),b=a.zbobj.height(),f=e/c,j=h/b,l=e,m=h;if(1>j||1>f)f<j?(l=c,m*=l/e):(m=b,l*=m/h);a.zbimg.width(l);a.zbimg.height(m);i&&"fixed"!=d.position&&k.css("overflow",d.defaultBodyOverflow);k=a.zbobj.offset();d.mouseX=k.left+a.zbobj.width()/2;d.mouseY=k.top+a.zbobj.height()/2;q(a,d)}}function u(a,d){var i=d.timeoutSpeed,g=a.zbobj.width(),e=a.zbobj.height(),h=a.zbimg.width(),c=a.zbimg.height(),b=a.zbobj.offset(),f=a.zbimg.offset(),j=-1*(d.mouseX-b.left)/g*(h-g),l=-1*(d.mouseY-b.top)/e*(c-e),g=h==g?0:-(h-g);0<=j?j=0:j<g&&(j=g);e=c==e?0:-(c-e);0<=l?l=0:l<e&&(l=e);e=parseFloat(f.left-b.left);b=parseFloat(f.top-b.top);f=e;f=b;j!=e&&(f=j-e,c=0.2*(j-e),1>f&&-1<f&&(c=f),f=Math.floor(10*(e+c))/10,a.zbimg.css("left",f+"px"));l!=b&&(f=l-b,c=0.2*(l-b),1>f&&-1<f&&(c=f),f=Math.floor(10*(b+c))/10,a.zbimg.css("top",f+"px"));!1!==d.animator.timer&&(clearTimeout(d.animator.timer),d.animator.timer=!1);if(!1===d.animator.timer&&(e!=j||b!=l))d.animator.timer=setTimeout(function(){u(a,d)},i)}function q(a,d){a.zbobj&&d&&!1===d.animator.timer&&u(a,d)}function v(a,d){d.isopen=!1;a.zbobj.fadeOut(400,function(){a.zbobj.remove();a={};delete i[d.zbid-1].zbobjects;!1!==d.animator.timer&&(clearTimeout(d.animator.timer),d.animator.timer=!1);g("body").css({overflow:d.defaultBodyOverflow,"margin-right":d.defaultMarginRight})})}var r={boxWidth:"auto",boxHeight:"auto",boxLeft:"auto",boxTop:"auto",allowDrag:!0,imageSource:"auto",appendBoxTo:"body",fitBoxTo:window,alignBoxTo:window,boxId:"",boxClass:"",position:"fixed",closeText:"",onUpdateScale:!1},i=[];g.fn.ZoomBox=function(a){var a=a||{},d=g.extend({},r,a),a=g(this);if(0<a.length){var k=g("body"),n=k.css("overflow"),e=k.css("margin-right"),h=Math.round(1E3/30);a.each(function(){var a=g(this),b=g.extend({},d),f;for(f in r)if(r.hasOwnProperty(f)){var j=t(a,"data-"+f.toLowerCase());j&&(b[f]=j)}b.imageSource="auto"==b.imageSource?t(a,"href"):b.imageSource;f=b.imageSource;b.naturalImgWidth=0;b.naturalImgHeight=0;j=new Image;j.src=f;j.onload=function(){b.naturalImgWidth=this.width;b.naturalImgHeight=this.height};b.zbid=i.length+1;b.animator={timer:!1,startTime:0};i.push({object:a,settings:b});b.isopen=!1;b.defaultBodyOverflow=n;b.defaultMarginRight=e;b.timeoutSpeed=h;b.mouseX=0;b.mouseY=0;b.mouseDownX=-999;b.mouseDownY=-999;a.click(function(a){a.preventDefault();if(!b.isopen){a=g("body");b.defaultBodyOverflow=a.css("overflow");b.defaultMarginRight=a.css("margin-right");var a=b.zbid,d="string"==typeof b.imageSource?b.imageSource:"",e='<div class="zoom-box-container" data-zbid="'+a+'"><a href="javascript:void(0);" class="zoom-box-close">'+("string"==typeof b.closeText?b.closeText:"")+'</a><img src="'+d+'" alt="" /></div>',c={relativeHolder:"object"==typeof b.appendBoxTo&&b.appendBoxTo!=window?b.appendBoxTo:g(b.appendBoxTo),relativeFit:"object"==typeof b.fitBoxTo&&b.fitBoxTo!=window||!b.fitBoxTo?b.fitBoxTo:g(b.fitBoxTo),relativeAlign:"object"==typeof b.alignBoxTo&&b.alignBoxTo!=window||!b.alignBoxTo?b.alignBoxTo:g(b.alignBoxTo)};d&&(c.relativeHolder.length&&0!=b.naturalImgWidth&&0!=b.naturalImgHeight)&&(c.relativeHolder=c.relativeHolder.eq(0),c.relativeHolder.append(e),c.zbobj=c.relativeHolder.find('.zoom-box-container[data-zbid="'+a+'"]'),c.zbimg=c.zbobj.find("img"),c.zbclose=c.zbobj.find("a.zoom-box-close"),c.zbobj.css({position:b.position,"z-index":"990",visibility:"hidden"}),c.zbimg.css({position:"absolute","z-index":"991","max-width":"none","max-height":"none"}),c.zbclose.css({position:"absolute","z-index":"992"}),p(c,b),c.zbobj.css({visibility:"visible",overflow:"hidden",display:"none"}).fadeIn(400),c.zbimg.on("dragstart",function(b){b.preventDefault()}),c.zbobj.on("mousemove",function(a){b.mouseX=a.pageX;b.mouseY=a.pageY;q(c,b)}).on("touchmove",function(a){a.preventDefault();b.mouseX=a.originalEvent.touches[0].pageX;b.mouseY=a.originalEvent.touches[0].pageY;q(c,b)}).on("mousedown",function(a){a.preventDefault();b.mouseDownX=a.pageX;b.mouseDownY=a.pageY}).on("mouseup",function(a){a.preventDefault();a.pageX<=b.mouseDownX+5&&(a.pageX>=b.mouseDownX-5&&a.pageY<=b.mouseDownY+5&&a.pageY>=b.mouseDownY-5)&&v(c,b);b.mouseDownX=-999;b.mouseDownY=-999}),c.zbclose.click(function(a){a.preventDefault();v(c,b)}),i[a-1].zbobjects=c);b.isopen=!0}})})}};var n=!1;g(window).on("resize.zoombox",function(){!1==n&&(n=!0,setTimeout(function(){for(var a=0;a<i.length;a++)"undefined"!==typeof i[a].zbobjects&&p(i[a].zbobjects,i[a].settings);n=!1},100))});var s=!1;g(window).on("scroll.zoombox",function(){if(!1==s){for(var a=0;a<i.length;a++)"undefined"!==typeof i[a].zbobjects&&p(i[a].zbobjects,i[a].settings);s=!0;setTimeout(function(){for(var a=0;a<i.length;a++)"undefined"!==typeof i[a].zbobjects&&p(i[a].zbobjects,i[a].settings);s=!1},10)}})})(jQuery);
