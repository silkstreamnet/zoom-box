(function(j){function s(a,d){var k=a.attr(d);return"undefined"==typeof k?"":k}function m(a,d){if("function"===typeof d.onUpdateScale)d.onUpdateScale(d);var k=j("body"),b=k.css("overflow");d.fitBoxTo==window&&k.css("overflow","hidden");a.zbobj.css({top:"0",left:"0"});"string"==typeof d.boxClass&&""!=d.boxClass&&a.zbobj.addClass(d.boxClass);"string"==typeof d.boxId&&""!=d.boxId&&a.zbobj.attr("id",d.boxId);var e=d.boxWidth,c=d.boxHeight,h=d.boxLeft,f=d.boxTop;"not set"!=e&&("auto"==e?(e=d.fitBoxTo==window?a.relativeFit.width():a.relativeFit.outerWidth(!1),a.zbobj.width(e)):e.match(/[0-9]{1,2}%/)?a.zbobj.css("width",e):a.zbobj.width(parseInt(e)));"not set"!=c&&("auto"==c?(c=d.fitBoxTo==window?a.relativeFit.height():a.relativeFit.outerHeight(!1),a.zbobj.height(c)):c.match(/[0-9]{1,2}%/)?a.zbobj.css("height",c):a.zbobj.height(parseInt(c)));e=a.zbobj.offset();c=a.relativeAlign.offset();"not set"!=h?"auto"==h?(h=d.alignBoxTo==window?0<e.left?-e.left:0:e.left==c.left?0:e.left>c.left?0-(e.left-c.left):c.left-e.left,a.zbobj.css("left",h+"px")):h.match(/[0-9]{1,2}%/)?a.zbobj.css("left",h):a.zbobj.css("left",parseInt(h)+"px"):a.zbobj.css("left","");"not set"!=f?"auto"==f?(f=d.alignBoxTo==window?0<e.top?-e.top:0:e.top==c.top?0:e.top>c.top?0-(e.top-c.top):c.top-e.top,a.zbobj.css("top",f+"px")):f.match(/[0-9]{1,2}%/)?a.zbobj.css("top",f):a.zbobj.css("top",parseInt(f)+"px"):a.zbobj.css("top","");var h=d.naturalImgWidth,f=d.naturalImgHeight,e=a.zbobj.width(),c=a.zbobj.height(),i=h/e,t=f/c,l=h,g=f;if(1>t||1>i)i<t?(l=e,g*=l/h):(g=c,l*=g/f);a.zbimg.width(l);a.zbimg.height(g);d.fitBoxTo==window&&k.css("overflow",b);k=a.zbobj.offset();d.mouseX=k.left+a.zbobj.width()/2;d.mouseY=k.top+a.zbobj.height()/2;n(a,d)}function u(a,d){var g=Math.round(1E3/60),b=a.zbobj.width(),e=a.zbobj.height(),c=a.zbimg.width(),h=a.zbimg.height(),f=a.zbobj.offset(),i=a.zbimg.offset(),b=Math.round(100*-1*(d.mouseX-f.left)/b*(c-b))/100,e=Math.round(100*-1*(d.mouseY-f.top)/e*(h-e))/100,h=Math.round(100*parseFloat(i.left-f.left))/100,f=Math.round(100*parseFloat(i.top-f.top))/100;b!=h&&(i=b-h,c=0.1*(b-h),1>i&&-1<i&&(c=i),a.zbimg.css("left",h+c+"px"));e!=f&&(i=e-f,c=0.1*(e-f),1>i&&-1<i&&(c=i),a.zbimg.css("top",f+c+"px"));!1!==d.animator.timer&&(clearTimeout(d.animator.timer),d.animator.timer=!1);if(!1===d.animator.timer&&(h!=b||f!=e))d.animator.timer=setTimeout(function(){u(a,d)},g)}function n(a,d){a.zbobj&&d&&!1===d.animator.timer&&u(a,d)}var p={boxWidth:"auto",boxHeight:"auto",boxLeft:"auto",boxTop:"auto",allowDrag:!0,imageSource:"auto",appendBoxTo:"body",fitBoxTo:window,alignBoxTo:window,boxId:"",boxClass:"",position:"absolute",onUpdateScale:!1},g=[];j.fn.ZoomBox=function(a){var d=j.extend({},p,a),a=j(this);0<a.length&&a.each(function(){var a=j(this),b=j.extend({},d),e;for(e in p)if(p.hasOwnProperty(e)){var c=s(a,"data-"+e.toLowerCase());c&&(b[e]=c)}b.imageSource="auto"==b.imageSource?s(a,"href"):b.imageSource;e=b.imageSource;b.naturalImgWidth=0;b.naturalImgHeight=0;c=new Image;c.src=e;c.onload=function(){b.naturalImgWidth=this.width;b.naturalImgHeight=this.height};b.zbid=g.length+1;b.animator={timer:!1,startTime:0};g.push({object:a,settings:b});b.isopen=!1;a.click(function(a){a.preventDefault();if(!b.isopen){var a=b.zbid,d=b.imageSource,e='<div class="zoom-box-container" data-zbid="'+a+'"><img src="'+d+'" alt="" /></div>',c={relativeHolder:"object"==typeof b.appendBoxTo&&b.appendBoxTo!=window?b.appendBoxTo:j(b.appendBoxTo),relativeFit:"object"==typeof b.fitBoxTo&&b.fitBoxTo!=window||!b.fitBoxTo?b.fitBoxTo:j(b.fitBoxTo),relativeAlign:"object"==typeof b.alignBoxTo&&b.alignBoxTo!=window||!b.alignBoxTo?b.alignBoxTo:j(b.alignBoxTo)};c.relativeHolder.length&&(d&&0!=b.naturalImgWidth&&0!=b.naturalImgHeight)&&(c.relativeHolder=c.relativeHolder.eq(0),c.relativeHolder.append(e),c.zbobj=c.relativeHolder.find('.zoom-box-container[data-zbid="'+a+'"]'),c.zbimg=c.zbobj.find("img"),c.zbobj.css({position:b.position,"z-index":"990",visibility:"hidden"}),c.zbimg.css({position:"absolute","z-index":"991"}),m(c,b),c.zbobj.css({visibility:"visible",overflow:"hidden",display:"none"}).fadeIn(400),c.zbimg.on("dragstart",function(a){a.preventDefault()}),c.zbobj.on("mousemove",function(a){b.mouseX=a.pageX;b.mouseY=a.pageY;n(c,b)}).on("touchmove",function(a){b.mouseX=a.originalEvent.touches[0].pageX;b.mouseY=a.originalEvent.touches[0].pageY;n(c,b)}).click(function(a){a.preventDefault();b.isopen=!1;c.zbobj.fadeOut(400,function(){c.zbobj.remove();delete g[b.zbid-1].zbobjects;!1!==b.animator.timer&&(clearTimeout(b.animator.timer),b.animator.timer=!1)})}),g[a-1].zbobjects=c);b.isopen=!0}})})};var q=!1;j(window).resize(function(){!1==q&&(q=!0,setTimeout(function(){for(var a=0;a<g.length;a++)"undefined"!==typeof g[a].zbobjects&&m(g[a].zbobjects,g[a].settings);q=!1},100))});var r=!1;j(window).scroll(function(){!1==r&&(r=!0,setTimeout(function(){for(var a=0;a<g.length;a++)"undefined"!==typeof g[a].zbobjects&&m(g[a].zbobjects,g[a].settings);r=!1},100))})})(jQuery);
