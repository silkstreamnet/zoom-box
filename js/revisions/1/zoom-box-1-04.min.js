(function(l){function q(b,a){var g=b.attr(a);return"undefined"==typeof g?"":g}function n(b,a){if(b.zbobj){if("function"===typeof a.onUpdateScale)a.onUpdateScale(a);var g=l("body"),j=!1;if(a.fitBoxTo==window&&(a.position="fixed")){var j=!0,e=g.width();g.css("overflow","hidden");var h=g.width();h>e&&(e=parseInt(g.css("margin-right"))+(h-e),g.css("margin-right",e+"px"))}b.zbobj.css({top:"0",left:"0"});"string"==typeof a.boxClass&&""!=a.boxClass&&b.zbobj.addClass(a.boxClass);"string"==typeof a.boxId&&""!=a.boxId&&b.zbobj.attr("id",a.boxId);var d=a.boxWidth,f=a.boxHeight,e=a.boxLeft,h=a.boxTop;"not set"!=d&&("auto"==d?(d=a.fitBoxTo==window?b.relativeFit.width():b.relativeFit.outerWidth(!1),b.zbobj.width(d)):"string"==typeof d&&d.match(/[0-9]{1,2}%/)?b.zbobj.css("width",d):b.zbobj.width(parseFloat(d)));"not set"!=f&&("auto"==f?(f=a.fitBoxTo==window?b.relativeFit.height():b.relativeFit.outerHeight(!1),b.zbobj.height(f)):"string"==typeof f&&f.match(/[0-9]{1,2}%/)?b.zbobj.css("height",f):b.zbobj.height(parseFloat(f)));d=b.zbobj.offset();f=b.relativeAlign?b.relativeAlign.offset():0;"not set"!=e?"auto"==e?(e=a.alignBoxTo==window?"fixed"!=a.position&&0<d.left?-d.left:0:d.left==f.left?0:d.left>f.left?0-(d.left-f.left):f.left-d.left,b.zbobj.css("left",e+"px")):"string"==typeof e&&e.match(/[0-9]{1,2}%/)?b.zbobj.css("left",e):b.zbobj.css("left",parseFloat(e)+"px"):b.zbobj.css("left","");"not set"!=h?"auto"==h?(h=a.alignBoxTo==window?"fixed"!=a.position&&0<d.top?-d.top:0:d.top==f.top?0:d.top>f.top?0-(d.top-f.top):f.top-d.top,b.zbobj.css("top",h+"px")):"string"==typeof h&&h.match(/[0-9]{1,2}%/)?b.zbobj.css("top",h):b.zbobj.css("top",parseFloat(h)+"px"):b.zbobj.css("top","");var e=a.naturalImgWidth,h=a.naturalImgHeight,d=b.zbobj.width(),f=b.zbobj.height(),c=e/d,k=h/f,i=e,p=h;if(1>k||1>c)c<k?(i=d,p*=i/e):(p=f,i*=p/h);b.zbimg.width(i);b.zbimg.height(p);j&&"fixed"!=a.position&&g.css("overflow",a.defaultBodyOverflow);g=b.zbobj.offset();a.mouseX=g.left+b.zbobj.width()/2;a.mouseY=g.top+b.zbobj.height()/2;r(b,a)}}function v(b,a){var g=a.timeoutSpeed,j=b.zbobj.width(),e=b.zbobj.height(),h=b.zbimg.width(),d=b.zbimg.height(),f=b.zbobj.offset(),c=b.zbimg.offset(),k=-1*(a.mouseX-f.left)/j*(h-j),i=-1*(a.mouseY-f.top)/e*(d-e);a.invert&&(k=-1*(h-j)+Math.abs(k),i=-1*(d-e)+Math.abs(i));j=h==j?0:-1*(h-j);0<=k?k=0:k<j&&(k=j);e=d==e?0:-1*(d-e);0<=i?i=0:i<e&&(i=e);e=parseFloat(c.left-f.left);f=parseFloat(c.top-f.top);c=e;c=f;k!=e&&(c=k-e,d=0.2*(k-e),1>c&&-1<c&&(d=c),c=Math.floor(10*(e+d))/10,b.zbimg.css("left",c+"px"));i!=f&&(c=i-f,d=0.2*(i-f),1>c&&-1<c&&(d=c),c=Math.floor(10*(f+d))/10,b.zbimg.css("top",c+"px"));!1!==a.animator.timer&&(clearTimeout(a.animator.timer),a.animator.timer=!1);if(!1===a.animator.timer&&(e!=k||f!=i))a.animator.timer=setTimeout(function(){v(b,a)},g)}function r(b,a){b.zbobj&&a&&!1===a.animator.timer&&v(b,a)}function w(b,a){var g=l("body");a.defaultBodyOverflow=g.css("overflow");a.defaultMarginRight=g.css("margin-right");var g=a.zbid,j="",e=0,h=0,d=b,j=q(d,"src");if(!j){var f=b.find("img");0<f.length&&(d=f.eq(0),j=q(d,"src"))}j&&(e=d.width(),h=d.height());a.naturalImgWidth=e;a.naturalImgHeight=h;var j='<div class="zoom-box-container" data-zbid="'+g+'"><a href="javascript:void(0);" class="zoom-box-close">'+("string"==typeof a.closeText?a.closeText:"")+'</a><img src="'+j+'" alt="" /></div>',c={relativeHolder:"object"==typeof a.appendBoxTo&&a.appendBoxTo!=window?a.appendBoxTo:l(a.appendBoxTo),relativeFit:"object"==typeof a.fitBoxTo&&a.fitBoxTo!=window||!a.fitBoxTo?a.fitBoxTo:l(a.fitBoxTo),relativeAlign:"object"==typeof a.alignBoxTo&&a.alignBoxTo!=window||!a.alignBoxTo?a.alignBoxTo:l(a.alignBoxTo)};if(c.relativeHolder.length){var k=!1;c.relativeHolder=c.relativeHolder.eq(0);c.relativeHolder.append(j);c.zbobj=c.relativeHolder.find('.zoom-box-container[data-zbid="'+g+'"]');c.zbimg=c.zbobj.find("img");c.zbclose=c.zbobj.find("a.zoom-box-close");c.zbobj.css({position:a.position,"z-index":"990",visibility:"hidden"});c.zbimg.css({position:"absolute","z-index":"991","max-width":"none","max-height":"none"});c.zbclose.css({position:"absolute","z-index":"992"});n(c,a);c.zbobj.css({visibility:"visible",overflow:"hidden",display:"none"}).fadeIn(400,function(){setTimeout(function(){k=!0},100)});c.zbimg.on("dragstart",function(a){a.preventDefault()});c.zbobj.on("mousemove",function(b){k&&(a.mouseX=b.pageX,a.mouseY=b.pageY,a.invert=!1,r(c,a))}).on("touchmove",function(b){b.preventDefault();k&&(a.mouseX=b.originalEvent.touches[0].pageX,a.mouseY=b.originalEvent.touches[0].pageY,a.invert=!0,r(c,a))}).on("mousedown",function(b){b.preventDefault();a.mouseDownX=b.pageX;a.mouseDownY=b.pageY}).on("mouseup",function(b){b.preventDefault();b.pageX<=a.mouseDownX+5&&(b.pageX>=a.mouseDownX-5&&b.pageY<=a.mouseDownY+5&&b.pageY>=a.mouseDownY-5)&&x(c,a);a.mouseDownX=-999;a.mouseDownY=-999});c.zbclose.click(function(b){b.preventDefault();x(c,a)});m[g-1].zbobjects=c;a._imageSource="auto"==a.imageSource?q(b,"href"):a.imageSource;a.naturalImgWidth=0;a.naturalImgHeight=0;if(a._imageSource){var i=new Image;i.src=a._imageSource;setTimeout(function(){i.complete?(a.naturalImgWidth=i.width,a.naturalImgHeight=i.height,c.zbimg.attr("src",a._imageSource),n(c,a)):i.onload=function(){a.naturalImgWidth=this.width;a.naturalImgHeight=this.height;c.zbimg.attr("src",a._imageSource);n(c,a)}},1)}a.isopen=!0}else a.isopen=!1}function x(b,a){a.isopen&&(b.zbobj.fadeOut(400,function(){b.zbobj.remove();b={};delete m[a.zbid-1].zbobjects;!1!==a.animator.timer&&(clearTimeout(a.animator.timer),a.animator.timer=!1);l("body").css({overflow:a.defaultBodyOverflow,"margin-right":a.defaultMarginRight})}),a.isopen=!1)}var s={boxWidth:"auto",boxHeight:"auto",boxLeft:"auto",boxTop:"auto",imageSource:"auto",appendBoxTo:"body",fitBoxTo:window,alignBoxTo:window,boxId:"",boxClass:"",position:"fixed",closeText:"",delegate:"",onUpdateScale:!1},m=[];l.fn.ZoomBox=function(b){var b=b||{},a=l.extend({},s,b),b=l(this);if(0<b.length){var g=l("body"),j=g.css("overflow"),e=g.css("margin-right"),h=Math.round(1E3/30);b.each(function(){var b=l(this),f="string"==typeof a.delegate?a.delegate:"",c=l.extend({},a),g;for(g in s)if(s.hasOwnProperty(g)){var i=q(b,"data-"+g.toLowerCase());i&&(c[g]=i)}c.zbid=m.length+1;c.animator={timer:!1,startTime:0};m.push({object:b,settings:c});c.isopen=!1;c.defaultBodyOverflow=j;c.defaultMarginRight=e;c.timeoutSpeed=h;c.mouseX=0;c.mouseY=0;c.mouseDownX=-999;c.mouseDownY=-999;c.invert=!1;if(f)b.on("click",f,function(a){a.preventDefault();c.isopen||w(l(this),c)});else b.on("click",function(a){a.preventDefault();c.isopen||w(l(this),c)})})}};var t=!1;l(window).on("resize.zoombox",function(){!1==t&&(t=!0,setTimeout(function(){for(var b=0;b<m.length;b++)"undefined"!==typeof m[b].zbobjects&&n(m[b].zbobjects,m[b].settings);t=!1},100))});var u=!1;l(window).on("scroll.zoombox",function(){if(!1==u){for(var b=0;b<m.length;b++)"undefined"!==typeof m[b].zbobjects&&n(m[b].zbobjects,m[b].settings);u=!0;setTimeout(function(){for(var a=0;a<m.length;a++)"undefined"!==typeof m[a].zbobjects&&n(m[a].zbobjects,m[a].settings);u=!1},10)}})})(jQuery);