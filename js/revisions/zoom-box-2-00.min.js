(function(l){function y(a,g,d,c,k){var f=c.$zoombox.width(),h=c.$zoombox.height();c.moveready=!0;c.naturalImgWidth=g;c.naturalImgHeight=d;c.$zoomboxImage.attr("src",a);s(c,k);c.$zoomboxImage.css("left",(f-c.$zoomboxImage.width())/2+"px");c.$zoomboxImage.css("top",(h-c.$zoomboxImage.height())/2+"px");c.mouseX=f/2;c.mouseY=h/2;c.$zoombox.trigger("mousemove")}function n(a,g){var d=a.attr(g);return"undefined"==typeof d?"":d}function z(a,g){for(var d in t)if(t.hasOwnProperty(d)){var c=n(a,"data-"+d.toLowerCase());c&&(g[d]="false"===c?!1:c)}}function s(a,g){var d=!1!==g.renderWidth?g.renderWidth:"100%",c=!1!==g.renderHeight?g.renderHeight:"100%";if(g.renderOverImage)a.$mousetrap.css({width:"100%",height:"100%"});else{var k=a.$oimage.width(),f=a.$oimage.height(),h=a.$oimage.parent().width(),j=a.$oimage.parent().height();k<h?a.$mousetrap.width(k):a.$mousetrap.width(h);f<j?a.$mousetrap.height(f):a.$mousetrap.height(j)}"string"==typeof d&&d.match(/[0-9]{1,3}%/)?a.$zoombox.css("width",d):"number"==typeof d&&a.$zoombox.width(d);"string"==typeof c&&c.match(/[0-9]{1,3}%/)?a.$zoombox.css("height",c):"number"==typeof c&&a.$zoombox.height(c);var d=a.naturalImgWidth,c=a.naturalImgHeight,k=a.$zoombox.width(),f=a.$zoombox.height(),h=d/k,j=c/f,e=d,i=c;if(1>j||1>h)h<j?(e=k,i*=e/d):(i=f,e*=i/c);a.$zoomboxImage.width(e);a.$zoomboxImage.height(i);!1===a.animator.timer&&r(a,g)}function r(a,g){var d=a.timeoutSpeed,c=a.$zoombox.width(),e=a.$zoombox.height(),f=a.$zoomboxImage.width(),h=a.$zoomboxImage.height(),j=a.$zoomboxImage.position(),m=-1*a.mouseX/c*(f-c),i=-1*a.mouseY/e*(h-e);a.invert&&(m=-1*(f-c)+Math.abs(m),i=-1*(h-e)+Math.abs(i));c=f==c?0:-1*(f-c);0<m?m=0:m<c&&(m=c);e=h==e?0:-1*(h-e);0<i?i=0:i<e&&(i=e);e=parseFloat(j.left);j=parseFloat(j.top);c=e;h=j;h=a.latency;m!=e&&(c=m-e,f=(m-e)*h,1>c&&-1<c&&(f=c),c=Math.floor(10*(e+f))/10,a.$zoomboxImage.css("left",c+"px"));i!=j&&(c=i-j,h*=i-j,1>c&&-1<c&&(h=c),h=Math.floor(10*(j+h))/10,a.$zoomboxImage.css("top",h+"px"));!1!==a.animator.timer&&(clearTimeout(a.animator.timer),a.animator.timer=!1);if(!1===a.animator.timer&&(e!=m||j!=i))a.animator.timer=setTimeout(function(){r(a,g)},d)}function u(a,e){if(a.isopen){if("function"===typeof e.onRemove)e.onRemove(e);a.isopen=!1;a.$zoombox.fadeOut(e.fadeDuration,function(){a.$zoombox.remove();a.$mousetrap.remove();!1!==a.animator.timer&&(clearTimeout(a.animator.timer),a.animator.timer=!1);a.$sobjects.attr("data-zbid","");"function"===typeof e.afterRemove&&e.afterRemove(e)})}}function v(){for(var a in e)if(e.hasOwnProperty(a)&&e[a]&&e[a].length)for(var g=0;g<e[a].length;g++)s(e[a][g].controllers,e[a][g].settings)}var t={renderContainer:!1,renderOverImage:!0,renderWidth:!1,renderHeight:!1,zoomSrc:"",closeText:"",imageClickClose:!1,refreshRate:30,fadeDuration:400,onRemove:!1,afterRemove:!1,onCreate:!1,afterCreate:!1},p=0,e=[];l.fn.ZoomBox=function(a){var a=a||{},g=l(this);if("string"==typeof a){var d=n(g,"data-zbid");if(d&&e[d]&&0<e[d].length)for(var c=0;c<e[d].length;c++)switch(a){case "remove":u(e[d][c].controllers,e[d][c].settings),c==e[d].length&&delete e[d]}}else{var k=l.extend({},t,a);if(0<g.length){var f=-1;g.each(function(){var a=n(l(this),"data-zbid");""!==a&&(f=parseInt(a))});if(0<=f&&e[f]&&0<e[f].length)for(a=0;a<e[f].length;a++)e[f][a].controllers.isopen||(e[f][a].controllers.$zoombox.stop(!0,!1).fadeTo(k.fadeDuration,1),e[f][a].controllers.isopen=!0);else{var h=Math.round(1E3/k.refreshRate);p++;e[p]=[];g.attr("data-zbid",p);g.each(function(){var a=l(this),c=l.extend({},k);z(a,c);var d=a;n(a,"src")||(d=a.find("img"));d.each(function(){var a=l(this),d=l.extend({},c);z(a,d);var b={id:p,$sobjects:g,$oimage:a,$oimageContainer:a.parent(),$renderContainer:!1,$zoombox:!1,$zoomboxImage:!1,$zoomboxClose:!1,$mousetrap:!1,originalSrc:"",renderOverImage:!1,isopen:!1,naturalImgWidth:0,naturalImgHeight:0,timeoutSpeed:h,mouseX:0,mouseY:0,mouseDownX:-999,mouseDownY:-999,touchX:-999,touchY:-999,invert:!1,moveready:!1,latency:0.2,animator:{timer:!1,startTime:0}};if("function"===typeof d.onCreate)d.onCreate(d);var a=b.$oimage,f="",i=0,j=0;if(a&&a.length&&(f=n(a,"src")))i=a.width(),j=a.height();b.originalSrc=f;b.naturalImgWidth=i;b.naturalImgHeight=j;a='<div class="zoom-box-container"><img class="zoom-box-image" src="'+b.originalSrc+'" alt="" /></div><a href="javascript:void(0);" class="zoom-box-close">'+("string"==typeof d.closeText?d.closeText:"")+"</a>";b.$renderContainer=!d.renderContainer||"object"==typeof d.renderContainer&&d.renderContainer!=window?d.renderContainer:l(d.renderContainer);if(!b.$renderContainer||!b.$renderContainer.length)b.$renderContainer=b.$oimageContainer;if(b.$renderContainer&&b.$renderContainer.length){1<b.$renderContainer.length&&(b.$renderContainer=b.$renderContainer.eq(0));b.$renderContainer.prepend(a);d.renderOverImage?(b.$renderContainer.prepend('<div class="zoom-box-mousetrap"></div>'),b.$mousetrap=b.$renderContainer.find(".zoom-box-mousetrap")):(b.$oimage.before('<div class="zoom-box-mousetrap"></div>'),b.$mousetrap=b.$oimageContainer.find(".zoom-box-mousetrap"));b.$zoombox=b.$renderContainer.find(".zoom-box-container");b.$zoomboxImage=b.$zoombox.find(".zoom-box-image");b.$zoomboxClose=b.$zoombox.find(".zoom-box-close");b.$zoombox.css({position:"absolute","z-index":"90",visibility:"hidden"});b.$zoomboxImage.css({position:"absolute","z-index":"91","max-width":"none","max-height":"none",display:"block"});b.$zoomboxClose.css({position:"absolute","z-index":"92"});b.$mousetrap.css({position:"absolute","z-index":"93",display:"block"});s(b,d);b.$zoombox.css({visibility:"visible",overflow:"hidden",display:"none"}).fadeIn(d.fadeDuration);b.$zoomboxImage.on("dragstart",function(a){a.preventDefault()});b.$mousetrap.on("mousemove",function(a){if(b.moveready){b.invert=!1;b.latency=0.2;var c=b.$zoombox.offset();b.mouseX=a.pageX-c.left;b.mouseY=a.pageY-c.top;!1===b.animator.timer&&r(b,d)}}).on("touchmove",function(a){a.preventDefault();if(b.moveready){b.invert=!0;b.latency=1;var c=b.$zoombox.offset(),e=a.originalEvent.touches[0].pageX-c.left,a=a.originalEvent.touches[0].pageY-c.top,c=b.$mousetrap.width(),f=b.$mousetrap.height();0<=b.touchX&&0<=b.touchY&&(b.mouseX+=e-b.touchX,b.mouseY+=a-b.touchY,b.mouseX>c?b.mouseX=c:0>b.mouseX&&(b.mouseX=0),b.mouseY>f?b.mouseY=f:0>b.mouseY&&(b.mouseY=0),!1===b.animator.timer&&r(b,d));b.touchX=e;b.touchY=a}}).on("mousedown",function(a){a.preventDefault();var c=b.$zoombox.offset();b.mouseDownX=a.pageX-c.left;b.mouseDownY=a.pageY-c.top}).on("mouseup",function(a){a.preventDefault();if(d.imageClickClose){var c=b.$zoombox.offset();a.pageX-c.left<=b.mouseDownX+5&&(a.pageX-c.left>=b.mouseDownX-5&&a.pageY-c.top<=b.mouseDownY+5&&a.pageY-c.top>=b.mouseDownY-5)&&u(b,d)}b.mouseDownX=-999;b.mouseDownY=-999}).on("touchend",function(){b.touchX=-999;b.touchY=-999});b.$zoomboxClose.click(function(a){a.preventDefault();u(b,d)});var k=d.zoomSrc?d.zoomSrc:b.originalSrc;if(k){var q=new Image;q.src=k;setTimeout(function(){q.complete?y(k,q.width,q.height,b,d):q.onload=function(){y(k,this.width,this.height,b,d)}},1)}b.isopen=!0;"function"===typeof d.afterCreate&&d.afterCreate(d)}else b.isopen=!1;e[p].push({controllers:b,settings:d})})})}}}};var w=!1;l(window).on("resize.zoombox",function(){!1==w&&(w=!0,setTimeout(function(){v();w=!1},100))});var x=!1;l(window).on("scroll.zoombox",function(){!1==x&&(v(),x=!0,setTimeout(function(){v();x=!1},10))})})(jQuery);