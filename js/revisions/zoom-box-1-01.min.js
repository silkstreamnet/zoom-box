(function(j){function s(a,c){var i=a.attr(c);return"undefined"==typeof i?"":i}function n(a,c){if("function"===typeof c.onUpdateScale)c.onUpdateScale(c);var i=j("body"),f=!1;if(c.fitBoxTo==window&&(c.position="fixed")){var f=!0,d=i.width();i.css("overflow","hidden");var g=i.width();g>d&&(d=parseInt(i.css("margin-right"))+(g-d),i.css("margin-right",d+"px"))}a.zbobj.css({top:"0",left:"0"});"string"==typeof c.boxClass&&""!=c.boxClass&&a.zbobj.addClass(c.boxClass);"string"==typeof c.boxId&&""!=c.boxId&&a.zbobj.attr("id",c.boxId);var b=c.boxWidth,e=c.boxHeight,d=c.boxLeft,g=c.boxTop;"not set"!=b&&("auto"==b?(b=c.fitBoxTo==window?a.relativeFit.width():a.relativeFit.outerWidth(!1),a.zbobj.width(b)):b.match(/[0-9]{1,2}%/)?a.zbobj.css("width",b):a.zbobj.width(parseInt(b)));"not set"!=e&&("auto"==e?(e=c.fitBoxTo==window?a.relativeFit.height():a.relativeFit.outerHeight(!1),a.zbobj.height(e)):e.match(/[0-9]{1,2}%/)?a.zbobj.css("height",e):a.zbobj.height(parseInt(e)));b=a.zbobj.offset();e=a.relativeAlign.offset();"not set"!=d?"auto"==d?(d=c.alignBoxTo==window?"fixed"!=c.position&&0<b.left?-b.left:0:b.left==e.left?0:b.left>e.left?0-(b.left-e.left):e.left-b.left,a.zbobj.css("left",d+"px")):d.match(/[0-9]{1,2}%/)?a.zbobj.css("left",d):a.zbobj.css("left",parseInt(d)+"px"):a.zbobj.css("left","");"not set"!=g?"auto"==g?(g=c.alignBoxTo==window?"fixed"!=c.position&&0<b.top?-b.top:0:b.top==e.top?0:b.top>e.top?0-(b.top-e.top):e.top-b.top,a.zbobj.css("top",g+"px")):g.match(/[0-9]{1,2}%/)?a.zbobj.css("top",g):a.zbobj.css("top",parseInt(g)+"px"):a.zbobj.css("top","");var d=c.naturalImgWidth,g=c.naturalImgHeight,b=a.zbobj.width(),e=a.zbobj.height(),h=d/b,t=g/e,k=d,l=g;if(1>t||1>h)h<t?(k=b,l*=k/d):(l=e,k*=l/g);a.zbimg.width(k);a.zbimg.height(l);f&&"fixed"!=c.position&&i.css("overflow",c.defaultBodyOverflow);i=a.zbobj.offset();c.mouseX=i.left+a.zbobj.width()/2;c.mouseY=i.top+a.zbobj.height()/2;p(a,c)}function u(a,c){var i=Math.round(1E3/60),f=a.zbobj.width(),d=a.zbobj.height(),g=a.zbimg.width(),b=a.zbimg.height(),e=a.zbobj.offset(),h=a.zbimg.offset(),f=Math.round(100*-1*(c.mouseX-e.left)/f*(g-f))/100,d=Math.round(100*-1*(c.mouseY-e.top)/d*(b-d))/100,b=Math.round(100*parseFloat(h.left-e.left))/100,e=Math.round(100*parseFloat(h.top-e.top))/100;f!=b&&(h=f-b,g=0.1*(f-b),1>h&&-1<h&&(g=h),a.zbimg.css("left",b+g+"px"));d!=e&&(h=d-e,g=0.1*(d-e),1>h&&-1<h&&(g=h),a.zbimg.css("top",e+g+"px"));!1!==c.animator.timer&&(clearTimeout(c.animator.timer),c.animator.timer=!1);if(!1===c.animator.timer&&(b!=f||e!=d))c.animator.timer=setTimeout(function(){u(a,c)},i)}function p(a,c){a.zbobj&&c&&!1===c.animator.timer&&u(a,c)}var q={boxWidth:"auto",boxHeight:"auto",boxLeft:"auto",boxTop:"auto",allowDrag:!0,imageSource:"auto",appendBoxTo:"body",fitBoxTo:window,alignBoxTo:window,boxId:"",boxClass:"",position:"fixed",onUpdateScale:!1},f=[];j.fn.ZoomBox=function(a){var a=a||{},c=j.extend({},q,a),a=j(this);if(0<a.length){var i=j("body"),m=i.css("overflow"),d=i.css("margin-right");a.each(function(){var a=j(this),b=j.extend({},c),e;for(e in q)if(q.hasOwnProperty(e)){var h=s(a,"data-"+e.toLowerCase());h&&(b[e]=h)}b.imageSource="auto"==b.imageSource?s(a,"href"):b.imageSource;e=b.imageSource;b.naturalImgWidth=0;b.naturalImgHeight=0;h=new Image;h.src=e;h.onload=function(){b.naturalImgWidth=this.width;b.naturalImgHeight=this.height};b.zbid=f.length+1;b.animator={timer:!1,startTime:0};f.push({object:a,settings:b});b.isopen=!1;b.defaultBodyOverflow=m;b.defaultMarginRight=d;a.click(function(a){a.preventDefault();if(!b.isopen){a=j("body");b.defaultBodyOverflow=a.css("overflow");b.defaultMarginRight=a.css("margin-right");var a=b.zbid,c=b.imageSource,e='<div class="zoom-box-container" data-zbid="'+a+'"><img src="'+c+'" alt="" /></div>',d={relativeHolder:"object"==typeof b.appendBoxTo&&b.appendBoxTo!=window?b.appendBoxTo:j(b.appendBoxTo),relativeFit:"object"==typeof b.fitBoxTo&&b.fitBoxTo!=window||!b.fitBoxTo?b.fitBoxTo:j(b.fitBoxTo),relativeAlign:"object"==typeof b.alignBoxTo&&b.alignBoxTo!=window||!b.alignBoxTo?b.alignBoxTo:j(b.alignBoxTo)};d.relativeHolder.length&&(c&&0!=b.naturalImgWidth&&0!=b.naturalImgHeight)&&(d.relativeHolder=d.relativeHolder.eq(0),d.relativeHolder.append(e),d.zbobj=d.relativeHolder.find('.zoom-box-container[data-zbid="'+a+'"]'),d.zbimg=d.zbobj.find("img"),d.zbobj.css({position:b.position,"z-index":"990",visibility:"hidden"}),d.zbimg.css({position:"absolute","z-index":"991","max-width":"none","max-height":"none"}),n(d,b),d.zbobj.css({visibility:"visible",overflow:"hidden",display:"none"}).fadeIn(400),d.zbimg.on("dragstart",function(b){b.preventDefault()}),d.zbobj.on("mousemove",function(a){b.mouseX=a.pageX;b.mouseY=a.pageY;p(d,b)}).on("touchmove",function(a){b.mouseX=a.originalEvent.touches[0].pageX;b.mouseY=a.originalEvent.touches[0].pageY;p(d,b)}).click(function(a){a.preventDefault();b.isopen=!1;d.zbobj.fadeOut(400,function(){d.zbobj.remove();delete f[b.zbid-1].zbobjects;!1!==b.animator.timer&&(clearTimeout(b.animator.timer),b.animator.timer=!1);j("body").css({overflow:b.defaultBodyOverflow,"margin-right":b.defaultMarginRight})})}),f[a-1].zbobjects=d);b.isopen=!0}})})}};var m=!1;j(window).resize(function(){!1==m&&(m=!0,setTimeout(function(){for(var a=0;a<f.length;a++)"undefined"!==typeof f[a].zbobjects&&n(f[a].zbobjects,f[a].settings);m=!1},100))});var r=!1;j(window).scroll(function(){!1==r&&(r=!0,setTimeout(function(){for(var a=0;a<f.length;a++)"undefined"!==typeof f[a].zbobjects&&n(f[a].zbobjects,f[a].settings);r=!1},100))})})(jQuery);
